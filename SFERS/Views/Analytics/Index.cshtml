@{
    ViewData["Title"] = "Analytics";
}
@model SFERS.Models.ViewModel.AnalyticsViewModel

<h2><i class="fas fa-chart-line me-2"></i>Analytics & Insights</h2>
<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">Most Used Rooms</h5>
                <canvas id="mostUsedChart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">Equipment Demand</h5>
                <canvas id="equipmentPieChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
        <h5 class="mb-0">Weekly Usage Report</h5>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Room</th>
                    <th>Date</th>
                    <th>Time Slot</th>
                    <th>Purpose</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.RecentReservations)
                {
                    <tr>
                        <td class="fw-semibold">
                            @item.RoomName
                        </td>
                        <td>@item.Date.ToShortDateString()</td>
                        <td>@item.TimeSlot</td>
                        <td>@item.Purpose</td>
                        <td>
                            @if (item.Status == "Approved")
                            {
                                <span class="badge bg-success">Approved</span>
                            }
                            else if (item.Status == "Declined")
                            {
                                <span class="badge bg-danger">Declined</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">Pending</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Extract data from model dictionaries
            const roomLabels = @Html.Raw(Json.Serialize(Model.MonthlyReservationCounts.Values.Select(r => r.RoomName)));
            const roomData = @Html.Raw(Json.Serialize(Model.MonthlyReservationCounts.Values.Select(r => r.UsageCount)));
            
            const equipmentLabels = @Html.Raw(Json.Serialize(Model.EquipmentUsages.Values.Select(e => e.EquipmentName)));
            const equipmentData = @Html.Raw(Json.Serialize(Model.EquipmentUsages.Values.Select(e => e.UsageCount)));

            // Bar Chart - Most Used Rooms
            const ctxBar = document.getElementById('mostUsedChart');
            new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: roomLabels,
                    datasets: [{
                        label: '# of Bookings',
                        data: roomData,
                        backgroundColor: '#3498db'
                    }]
                }
            });

            // Pie Chart - Equipment Demand
            const ctxPie = document.getElementById('equipmentPieChart');
            new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: equipmentLabels,
                    datasets: [{
                        data: equipmentData,
                        backgroundColor: ['#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6', '#1abc9c', '#e67e22']
                    }]
                }
            });
        });
    </script>
}